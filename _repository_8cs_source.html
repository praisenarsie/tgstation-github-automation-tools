<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-github-automation-tools: TGWebhooks/Core/Repository.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-github-automation-tools
   </div>
   <div id="projectbrief">Web tools for managing the tgstation repository</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6bef659e5d1950ab6d7d09bd3e444e2d.html">TGWebhooks</a></li><li class="navelem"><a class="el" href="dir_b7495edf02f3ccd907906c2770876c63.html">Core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Repository.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_repository_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_lib_git2_sharp.html">LibGit2Sharp</a>;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> Microsoft.Extensions.Logging;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> Microsoft.Extensions.Options;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_octokit.html">Octokit</a>;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Globalization;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Linq;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading.Tasks;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_webhooks.html">TGWebhooks</a>.<a class="code" href="namespace_t_g_webhooks_1_1_configuration.html">Configuration</a>;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_webhooks.html">TGWebhooks</a>.<a class="code" href="namespace_t_g_webhooks_1_1_modules.html">Modules</a>;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_webhooks.html">TGWebhooks</a>.Core</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;{</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#pragma warning disable CA1812</span></div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html">   18</a></span>&#160;    sealed <span class="keyword">class </span><a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html">Repository</a> : Modules.<a class="code" href="interface_t_g_webhooks_1_1_modules_1_1_i_repository.html">IRepository</a>, <a class="code" href="interface_t_g_webhooks_1_1_modules_1_1_i_initializable.html">IInitializable</a>, <a class="code" href="class_i_disposable.html">IDisposable</a></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#pragma warning restore CA1812</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    {</div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a308469c3887158d8e3ac947458c08ef4">   24</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> RepositoriesDirectory = <span class="stringliteral">&quot;Repositories&quot;</span>;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#aceb2050adbd2f86f7483addaf3be640f">   27</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> Path =&gt; repositoryObject.Info.WorkingDirectory;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#af84ae7aa84a73e1080ef10e8c5eeb3f2">   32</a></span>&#160;        readonly ILogger&lt;Repository&gt; <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#af84ae7aa84a73e1080ef10e8c5eeb3f2">logger</a>;</div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a2713b6c9fc10e345d7949dc6cb2fa8b4">   36</a></span>&#160;        readonly <a class="code" href="interface_t_g_webhooks_1_1_modules_1_1_i_i_o_manager.html">IIOManager</a> <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a2713b6c9fc10e345d7949dc6cb2fa8b4">ioManager</a>;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a2502ddddc8464baf047011fc27fdfe83">   40</a></span>&#160;        readonly <a class="code" href="class_t_g_webhooks_1_1_configuration_1_1_git_hub_configuration.html">GitHubConfiguration</a> <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a2502ddddc8464baf047011fc27fdfe83">gitHubConfiguration</a>;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a6101dd3ed4e3b8ed4def72e85a1ea6ab">   45</a></span>&#160;        <a class="code" href="namespace_lib_git2_sharp.html">LibGit2Sharp</a>.Repository <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a6101dd3ed4e3b8ed4def72e85a1ea6ab">repositoryObject</a>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a977b86becb1a93dc1d03a305d36a2fdd">   50</a></span>&#160;        SemaphoreSlim <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a977b86becb1a93dc1d03a305d36a2fdd">semaphore</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#ad8f915959a3241e496385744e8f4fdfa">   58</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#ad8f915959a3241e496385744e8f4fdfa">Repository</a>(IOptions&lt;GitHubConfiguration&gt; gitHubConfigurationOptions, ILogger&lt;Repository&gt; _logger, <a class="code" href="interface_t_g_webhooks_1_1_modules_1_1_i_i_o_manager.html">IIOManager</a> _ioManager)</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            logger = _logger ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(_logger));</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            gitHubConfiguration = gitHubConfigurationOptions?.Value ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(gitHubConfigurationOptions));</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            ioManager = <span class="keyword">new</span> <a class="code" href="class_t_g_webhooks_1_1_core_1_1_resolving_i_o_manager.html">ResolvingIOManager</a>(_ioManager ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(_ioManager)), _ioManager.<a class="code" href="interface_t_g_webhooks_1_1_modules_1_1_i_i_o_manager.html#a4f9c6b117fb7e2337720e32dbce06dc6">ConcatPath</a>(<a class="code" href="class_t_g_webhooks_1_1_core_1_1_application.html">Application</a>.<a class="code" href="class_t_g_webhooks_1_1_core_1_1_application.html#a224e6fca580fd9ddcb5d5f24141adda1">DataDirectory</a>, RepositoriesDirectory));</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            semaphore = <span class="keyword">new</span> SemaphoreSlim(1);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a87436eb607fc542dfa88d2f6136f574d">   69</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a87436eb607fc542dfa88d2f6136f574d">Dispose</a>()</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            repositoryObject?.Dispose();</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            semaphore.Dispose();</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#ab5ab3188f107bdb82f9a881fac60fecd">   76</a></span>&#160;        <span class="keyword">public</span> Task <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#ab5ab3188f107bdb82f9a881fac60fecd">Initialize</a>(CancellationToken cancellationToken)</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordflow">return</span> Task.Factory.StartNew(async () =&gt;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                <span class="keyword">using</span> (logger.BeginScope(<span class="stringliteral">&quot;Initializing repository...&quot;</span>))</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                    var repoPath = ioManager.ResolvePath(ioManager.ConcatPath(gitHubConfiguration.RepoOwner, gitHubConfiguration.RepoName));</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                    logger.LogTrace(<span class="stringliteral">&quot;Repo path evaluated to be: {0}&quot;</span>, repoPath);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                    {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                        logger.LogTrace(<span class="stringliteral">&quot;Creating repository object.&quot;</span>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                        cancellationToken.ThrowIfCancellationRequested();</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                        repositoryObject = <span class="keyword">new</span> <a class="code" href="namespace_lib_git2_sharp.html">LibGit2Sharp</a>.Repository(repoPath);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                        repositoryObject.RemoveUntrackedFiles();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                        cancellationToken.ThrowIfCancellationRequested();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                        repositoryObject.RetrieveStatus();</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                    <span class="keywordflow">catch</span> (OperationCanceledException e)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                        logger.LogDebug(e, <span class="stringliteral">&quot;Repository setup cancelled!&quot;</span>);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                        repositoryObject?.Dispose();</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                        cancellationToken.ThrowIfCancellationRequested();</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                        <span class="keyword">using</span> (logger.BeginScope(<span class="stringliteral">&quot;Repository fallback initializing...&quot;</span>))</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                        {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                            repositoryObject?.Dispose();</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                            <span class="keywordflow">try</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                            {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                                logger.LogTrace(<span class="stringliteral">&quot;Checking repository directory exists.&quot;</span>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                <span class="keywordflow">if</span> (await ioManager.DirectoryExists(repoPath, cancellationToken).ConfigureAwait(<span class="keyword">false</span>))</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                    logger.LogWarning(e, <span class="stringliteral">&quot;Failed to load repository! Deleting and cloning...&quot;</span>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                                    await ioManager.DeleteDirectory(repoPath, cancellationToken).ConfigureAwait(<span class="keyword">false</span>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                <span class="keywordflow">else</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                    logger.LogInformation(e, <span class="stringliteral">&quot;Cloning repository...&quot;</span>);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                <a class="code" href="namespace_lib_git2_sharp.html">LibGit2Sharp</a>.Repository.Clone(String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;https://github.com/{0}/{1}&quot;</span>, gitHubConfiguration.RepoOwner, gitHubConfiguration.RepoName), repoPath, <span class="keyword">new</span> CloneOptions</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                    Checkout = <span class="keyword">false</span>,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                    RecurseSubmodules = <span class="keyword">true</span>,</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                    OnProgress = (a) =&gt; !cancellationToken.IsCancellationRequested,</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                                    OnUpdateTips = (a, b, c) =&gt; !cancellationToken.IsCancellationRequested,</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                    OnTransferProgress = (a) =&gt; !cancellationToken.IsCancellationRequested</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                });</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                logger.LogInformation(<span class="stringliteral">&quot;Repo clone completed.&quot;</span>);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                                repositoryObject = <span class="keyword">new</span> <a class="code" href="namespace_lib_git2_sharp.html">LibGit2Sharp</a>.Repository(repoPath);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                            }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                            <span class="keywordflow">catch</span> (UserCancelledException e2)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                            {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                logger.LogDebug(e2, <span class="stringliteral">&quot;Repository setup cancelled!&quot;</span>);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                cancellationToken.ThrowIfCancellationRequested();</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                            }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                            <span class="keywordflow">catch</span> (Exception e2)</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                            {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                logger.LogCritical(e2, <span class="stringliteral">&quot;Unable to clone repository!&quot;</span>);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                            }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                        }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            }, cancellationToken, TaskCreationOptions.LongRunning, TaskScheduler.Current);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a62cdcd0f25a364fe60d9374b8c116cf9">  151</a></span>&#160;        <span class="keyword">public</span> Task&lt;string&gt; <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a62cdcd0f25a364fe60d9374b8c116cf9">CreatePullRequestWorkingCommit</a>(PullRequest pullRequest, CancellationToken cancellationToken)</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a081731912d39ffc18418d3f6e2f11b1d">  157</a></span>&#160;        <span class="keyword">public</span> Task&lt;SemaphoreSlimContext&gt; <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#a081731912d39ffc18418d3f6e2f11b1d">LockToCallStack</a>(CancellationToken cancellationToken)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_t_g_webhooks_1_1_modules_1_1_semaphore_slim_context.html">SemaphoreSlimContext</a>.<a class="code" href="class_t_g_webhooks_1_1_modules_1_1_semaphore_slim_context.html#a6c5bfdaeccb0a64278ebc6fd0e7cee6d">Lock</a>(semaphore, cancellationToken);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#aef91dee3e9b3d60faad9a996678795d4">  163</a></span>&#160;        <span class="keyword">public</span> Task&lt;string&gt; <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#aef91dee3e9b3d60faad9a996678795d4">CommitChanges</a>(IEnumerable&lt;string&gt; pathsToStage, CancellationToken cancellationToken)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="class_t_g_webhooks_1_1_core_1_1_repository.html#adfe2961cf88b4d76f876dbcc4f8fa508">  169</a></span>&#160;        <span class="keyword">public</span> Task <a class="code" href="class_t_g_webhooks_1_1_core_1_1_repository.html#adfe2961cf88b4d76f876dbcc4f8fa508">Push</a>(<span class="keywordtype">string</span> remote, <span class="keywordtype">string</span> branch, <span class="keywordtype">string</span> commit, <span class="keywordtype">string</span> token, <span class="keywordtype">bool</span> force, CancellationToken cancellationToken)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            var remoteObject = repositoryObject.Network.Remotes.Where(x =&gt; x.Url == remote).First();</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="keywordflow">return</span> Task.Factory.StartNew(() =&gt;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    repositoryObject.Network.Push(remoteObject, commit, String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;{0}{1}:{2}&quot;</span>, force ? <span class="stringliteral">&quot;+&quot;</span> : String.Empty, commit, branch), <span class="keyword">new</span> PushOptions()</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                    {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                        OnPushTransferProgress = (a, b, c) =&gt; !cancellationToken.IsCancellationRequested</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    });</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                <span class="keywordflow">catch</span> (UserCancelledException)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                    cancellationToken.ThrowIfCancellationRequested();</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            }, cancellationToken, TaskCreationOptions.LongRunning, TaskScheduler.Current);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div><div class="ttc" id="namespace_t_g_webhooks_1_1_configuration_html"><div class="ttname"><a href="namespace_t_g_webhooks_1_1_configuration.html">TGWebhooks.Configuration</a></div><div class="ttdef"><b>Definition:</b> <a href="_database_configuration_8cs_source.html#l00001">DatabaseConfiguration.cs:1</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_modules_1_1_semaphore_slim_context_html_a6c5bfdaeccb0a64278ebc6fd0e7cee6d"><div class="ttname"><a href="class_t_g_webhooks_1_1_modules_1_1_semaphore_slim_context.html#a6c5bfdaeccb0a64278ebc6fd0e7cee6d">TGWebhooks.Modules.SemaphoreSlimContext.Lock</a></div><div class="ttdeci">static async Task&lt; SemaphoreSlimContext &gt; Lock(SemaphoreSlim semaphore, CancellationToken cancellationToken)</div><div class="ttdoc">Asyncronously locks a semaphore  </div><div class="ttdef"><b>Definition:</b> <a href="_semaphore_slim_context_8cs_source.html#l00018">SemaphoreSlimContext.cs:18</a></div></div>
<div class="ttc" id="namespace_t_g_webhooks_html"><div class="ttname"><a href="namespace_t_g_webhooks.html">TGWebhooks</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_ad8f915959a3241e496385744e8f4fdfa"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#ad8f915959a3241e496385744e8f4fdfa">TGWebhooks.Core.Repository.Repository</a></div><div class="ttdeci">Repository(IOptions&lt; GitHubConfiguration &gt; gitHubConfigurationOptions, ILogger&lt; Repository &gt; _logger, IIOManager _ioManager)</div><div class="ttdoc">Construct a Repository </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00058">Repository.cs:58</a></div></div>
<div class="ttc" id="namespace_octokit_html"><div class="ttname"><a href="namespace_octokit.html">Octokit</a></div><div class="ttdef"><b>Definition:</b> <a href="_pull_request_review_event_payload_8cs_source.html#l00003">PullRequestReviewEventPayload.cs:3</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_configuration_1_1_git_hub_configuration_html"><div class="ttname"><a href="class_t_g_webhooks_1_1_configuration_1_1_git_hub_configuration.html">TGWebhooks.Configuration.GitHubConfiguration</a></div><div class="ttdoc">GitHub configuration settings </div><div class="ttdef"><b>Definition:</b> <a href="_git_hub_configuration_8cs_source.html#l00006">GitHubConfiguration.cs:6</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_application_html_a224e6fca580fd9ddcb5d5f24141adda1"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_application.html#a224e6fca580fd9ddcb5d5f24141adda1">TGWebhooks.Core.Application.DataDirectory</a></div><div class="ttdeci">static string DataDirectory</div><div class="ttdoc">The path to the directory the Application should use for data files </div><div class="ttdef"><b>Definition:</b> <a href="_application_8cs_source.html#l00041">Application.cs:41</a></div></div>
<div class="ttc" id="namespace_t_g_webhooks_1_1_modules_html"><div class="ttname"><a href="namespace_t_g_webhooks_1_1_modules.html">TGWebhooks.Modules</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_adfe2961cf88b4d76f876dbcc4f8fa508"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#adfe2961cf88b4d76f876dbcc4f8fa508">TGWebhooks.Core.Repository.Push</a></div><div class="ttdeci">Task Push(string remote, string branch, string commit, string token, bool force, CancellationToken cancellationToken)</div><div class="ttdoc">Pushes a commit  to a specified remote  branch , optionally force ing it. Must be done in the returne...</div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00169">Repository.cs:169</a></div></div>
<div class="ttc" id="namespace_lib_git2_sharp_html"><div class="ttname"><a href="namespace_lib_git2_sharp.html">LibGit2Sharp</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_resolving_i_o_manager_html"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_resolving_i_o_manager.html">TGWebhooks.Core.ResolvingIOManager</a></div><div class="ttdoc">An IIOManager that resolve relative paths from another IIOManager to a subdirectory of that ...</div><div class="ttdef"><b>Definition:</b> <a href="_resolving_i_o_manager_8cs_source.html#l00010">ResolvingIOManager.cs:10</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_a2502ddddc8464baf047011fc27fdfe83"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#a2502ddddc8464baf047011fc27fdfe83">TGWebhooks.Core.Repository.gitHubConfiguration</a></div><div class="ttdeci">readonly GitHubConfiguration gitHubConfiguration</div><div class="ttdoc">The GitHubConfiguration for the Repository </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00040">Repository.cs:40</a></div></div>
<div class="ttc" id="interface_t_g_webhooks_1_1_modules_1_1_i_initializable_html"><div class="ttname"><a href="interface_t_g_webhooks_1_1_modules_1_1_i_initializable.html">TGWebhooks.Modules.IInitializable</a></div><div class="ttdoc">Represents an object that requires initialization before use </div><div class="ttdef"><b>Definition:</b> <a href="_i_initializable_8cs_source.html#l00009">IInitializable.cs:9</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html">TGWebhooks.Core.Repository</a></div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00018">Repository.cs:18</a></div></div>
<div class="ttc" id="interface_t_g_webhooks_1_1_modules_1_1_i_repository_html"><div class="ttname"><a href="interface_t_g_webhooks_1_1_modules_1_1_i_repository.html">TGWebhooks.Modules.IRepository</a></div><div class="ttdoc">Represents the git repository being manager by the TGWebhooks </div><div class="ttdef"><b>Definition:</b> <a href="_i_repository_8cs_source.html#l00011">IRepository.cs:11</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_a977b86becb1a93dc1d03a305d36a2fdd"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#a977b86becb1a93dc1d03a305d36a2fdd">TGWebhooks.Core.Repository.semaphore</a></div><div class="ttdeci">SemaphoreSlim semaphore</div><div class="ttdoc">Used for guarding access to the Repository </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00050">Repository.cs:50</a></div></div>
<div class="ttc" id="interface_t_g_webhooks_1_1_modules_1_1_i_i_o_manager_html_a4f9c6b117fb7e2337720e32dbce06dc6"><div class="ttname"><a href="interface_t_g_webhooks_1_1_modules_1_1_i_i_o_manager.html#a4f9c6b117fb7e2337720e32dbce06dc6">TGWebhooks.Modules.IIOManager.ConcatPath</a></div><div class="ttdeci">string ConcatPath(params string[] paths)</div><div class="ttdoc">Combines an array of strings into a path </div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_a87436eb607fc542dfa88d2f6136f574d"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#a87436eb607fc542dfa88d2f6136f574d">TGWebhooks.Core.Repository.Dispose</a></div><div class="ttdeci">void Dispose()</div><div class="ttdoc">Disposes the repositoryObject </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00069">Repository.cs:69</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_ab5ab3188f107bdb82f9a881fac60fecd"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#ab5ab3188f107bdb82f9a881fac60fecd">TGWebhooks.Core.Repository.Initialize</a></div><div class="ttdeci">Task Initialize(CancellationToken cancellationToken)</div><div class="ttdoc">Load components in the IComponentProvider. Will be called before any other function  ...</div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00076">Repository.cs:76</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_application_html"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_application.html">TGWebhooks.Core.Application</a></div><div class="ttdoc">Startup point for the web application </div><div class="ttdef"><b>Definition:</b> <a href="_application_8cs_source.html#l00030">Application.cs:30</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_a2713b6c9fc10e345d7949dc6cb2fa8b4"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#a2713b6c9fc10e345d7949dc6cb2fa8b4">TGWebhooks.Core.Repository.ioManager</a></div><div class="ttdeci">readonly IIOManager ioManager</div><div class="ttdoc">The IIOManager for the Repository </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00036">Repository.cs:36</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_a081731912d39ffc18418d3f6e2f11b1d"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#a081731912d39ffc18418d3f6e2f11b1d">TGWebhooks.Core.Repository.LockToCallStack</a></div><div class="ttdeci">Task&lt; SemaphoreSlimContext &gt; LockToCallStack(CancellationToken cancellationToken)</div><div class="ttdoc">Restricts usage of the repo to the current call stack  </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00157">Repository.cs:157</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_a6101dd3ed4e3b8ed4def72e85a1ea6ab"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#a6101dd3ed4e3b8ed4def72e85a1ea6ab">TGWebhooks.Core.Repository.repositoryObject</a></div><div class="ttdeci">LibGit2Sharp.Repository repositoryObject</div><div class="ttdoc">The LibGit2Sharp.Repository for the Repository </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00045">Repository.cs:45</a></div></div>
<div class="ttc" id="class_i_disposable_html"><div class="ttname"><a href="class_i_disposable.html">IDisposable</a></div></div>
<div class="ttc" id="interface_t_g_webhooks_1_1_modules_1_1_i_i_o_manager_html"><div class="ttname"><a href="interface_t_g_webhooks_1_1_modules_1_1_i_i_o_manager.html">TGWebhooks.Modules.IIOManager</a></div><div class="ttdoc">Interface for using filesystems </div><div class="ttdef"><b>Definition:</b> <a href="_i_i_o_manager_8cs_source.html#l00010">IIOManager.cs:10</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_af84ae7aa84a73e1080ef10e8c5eeb3f2"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#af84ae7aa84a73e1080ef10e8c5eeb3f2">TGWebhooks.Core.Repository.logger</a></div><div class="ttdeci">readonly ILogger&lt; Repository &gt; logger</div><div class="ttdoc">The ILogger for the Repository </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00032">Repository.cs:32</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_modules_1_1_semaphore_slim_context_html"><div class="ttname"><a href="class_t_g_webhooks_1_1_modules_1_1_semaphore_slim_context.html">TGWebhooks.Modules.SemaphoreSlimContext</a></div><div class="ttdoc">Async lock context helper </div><div class="ttdef"><b>Definition:</b> <a href="_semaphore_slim_context_8cs_source.html#l00010">SemaphoreSlimContext.cs:10</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_aef91dee3e9b3d60faad9a996678795d4"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#aef91dee3e9b3d60faad9a996678795d4">TGWebhooks.Core.Repository.CommitChanges</a></div><div class="ttdeci">Task&lt; string &gt; CommitChanges(IEnumerable&lt; string &gt; pathsToStage, CancellationToken cancellationToken)</div><div class="ttdoc">Commits changes to the current working directory. Must be done in the returned SemaphoreSlimContext o...</div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00163">Repository.cs:163</a></div></div>
<div class="ttc" id="class_t_g_webhooks_1_1_core_1_1_repository_html_a62cdcd0f25a364fe60d9374b8c116cf9"><div class="ttname"><a href="class_t_g_webhooks_1_1_core_1_1_repository.html#a62cdcd0f25a364fe60d9374b8c116cf9">TGWebhooks.Core.Repository.CreatePullRequestWorkingCommit</a></div><div class="ttdeci">Task&lt; string &gt; CreatePullRequestWorkingCommit(PullRequest pullRequest, CancellationToken cancellationToken)</div><div class="ttdoc">Fetches the given pullRequest  into the IRepository and returns the proper HEAD commit. If the PullRequest.Commits count is more than one it will be squashed. Must be done in the returned SemaphoreSlimContext of LockToCallStack(CancellationToken)  </div><div class="ttdef"><b>Definition:</b> <a href="_repository_8cs_source.html#l00151">Repository.cs:151</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
